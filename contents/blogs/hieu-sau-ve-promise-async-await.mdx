# Hi·ªÉu s√¢u v·ªÅ Promise, Async/Await v√† lu·ªìng b·∫•t ƒë·ªìng b·ªô trong JavaScript

JavaScript c√≥ m·ªôt **c∆° ch·∫ø b·∫•t ƒë·ªìng b·ªô (asynchronous)** c·ª±c k·ª≥ m·∫°nh m·∫Ω gi√∫p ta vi·∫øt code ch·∫°y m∆∞·ª£t m√†, kh√¥ng ch·∫∑n UI, ƒë·∫∑c bi·ªát trong m√¥i tr∆∞·ªùng **frontend v√† backend event-driven** nh∆∞ Node.js.  
B√†i vi·∫øt n√†y s·∫Ω gi√∫p b·∫°n ƒëi s√¢u v√†o **Promise**, **Async/Await** v√† c√°ch ch√∫ng ho·∫°t ƒë·ªông c√πng **Event Loop**.

---

## ‚ö° Callback Hell ‚Äì Kh·ªüi ƒë·∫ßu c·ªßa m·ªçi r·∫Øc r·ªëi

Tr∆∞·ªõc khi c√≥ Promise, JavaScript x·ª≠ l√Ω b·∫•t ƒë·ªìng b·ªô b·∫±ng **callback**.  
V√≠ d·ª•:

```js
getUser(function (user) {
  getOrders(user.id, function (orders) {
    getOrderDetails(orders[0].id, function (details) {
      console.log(details);
    });
  });
});
```
K·∫øt qu·∫£: callback hell, code kh√≥ ƒë·ªçc v√† kh√≥ debug.

üß© Promise ‚Äì C·ª©u tinh c·ªßa b·∫•t ƒë·ªìng b·ªô

Promise l√† m·ªôt ƒë·ªëi t∆∞·ª£ng ƒë·∫°i di·ªán cho gi√° tr·ªã trong t∆∞∆°ng lai.
M·ªôt Promise c√≥ 3 tr·∫°ng th√°i:

pending ‚Äì ƒëang ch·ªù x·ª≠ l√Ω

fulfilled ‚Äì ƒë√£ ho√†n th√†nh

rejected ‚Äì b·ªã l·ªói

```js
const fetchData = new Promise((resolve, reject) => {
  setTimeout(() => {
    const success = true;
    if (success) resolve("‚úÖ D·ªØ li·ªáu ƒë√£ t·∫£i xong!");
    else reject("‚ùå L·ªói t·∫£i d·ªØ li·ªáu!");
  }, 1000);
});

fetchData
  .then((data) => console.log(data))
  .catch((err) => console.error(err));
```

üîÑ Promise chaining

B·∫°n c√≥ th·ªÉ chu·ªói nhi·ªÅu promise ƒë·ªÉ x·ª≠ l√Ω logic li√™n ti·∫øp:

```js
fetchUser()
  .then((user) => fetchPosts(user.id))
  .then((posts) => fetchComments(posts[0].id))
  .then((comments) => console.log(comments))
  .catch((err) => console.error("L·ªói:", err));
```

üí§ Async/Await ‚Äì Vi·∫øt code b·∫•t ƒë·ªìng b·ªô nh∆∞ ƒë·ªìng b·ªô

async v√† await gi√∫p b·∫°n vi·∫øt code Promise nh∆∞ synchronous:

```js
async function loadData() {
  try {
    const user = await fetchUser();
    const posts = await fetchPosts(user.id);
    const comments = await fetchComments(posts[0].id);
    console.log(comments);
  } catch (error) {
    console.error("L·ªói:", error);
  }
}
```

‚öôÔ∏è Promise.all & Promise.race

Khi c·∫ßn ch·∫°y nhi·ªÅu t√°c v·ª• c√πng l√∫c:

H√†m	M√¥ t·∫£
|Promise.all([...])  |	Ch·ªù t·∫•t c·∫£ Promise ho√†n th√†nh, ho·∫∑c fail n·∫øu c√≥ 1 l·ªói|
|Promise.race([...]) |	Tr·∫£ v·ªÅ Promise ho√†n th√†nh s·ªõm nh·∫•t|
|Promise.allSettled([...]) |	Lu√¥n tr·∫£ v·ªÅ k·∫øt qu·∫£ c·ªßa t·∫•t c·∫£, k·ªÉ c·∫£ l·ªói|

```js
const p1 = fetch("/api/user");
const p2 = fetch("/api/posts");

const [user, posts] = await Promise.all([p1, p2]);
console.log(user, posts);
```

üß† Khi n√†o n√™n d√πng Async/Await?
| T√¨nh hu·ªëng                     | Gi·∫£i ph√°p t·ªët nh·∫•t     |
|--------------------------------|----------------------|
| Ch·∫°y tu·∫ßn t·ª± c√≥ ph·ª• thu·ªôc       | Async/Await          |
| Ch·∫°y song song ƒë·ªôc l·∫≠p          | Promise.all          |
| G·ªçi nhi·ªÅu API kh√¥ng li√™n quan   | Promise.allSettled   |
| D·ª´ng s·ªõm khi c√≥ l·ªói             | Promise.race         |

üßµ M·ªëi quan h·ªá gi·ªØa Promise v√† Event Loop

Promise ho·∫°t ƒë·ªông trong Microtask Queue, nghƒ©a l√†:

Ch·∫°y ngay sau khi Stack tr·ªëng

Tr∆∞·ªõc c√°c Macrotask nh∆∞ setTimeout

```js
console.log("Start");

setTimeout(() => console.log("Timeout"), 0);

Promise.resolve().then(() => console.log("Promise"));

console.log("End");

// Output:
// Start
// End
// Promise
// Timeout
```

üí° T·ªïng k·∫øt

| Ki·∫øn th·ª©c     | √ù nghƒ©a                                           |
|---------------|--------------------------------------------------|
| Callback      | C∆° ch·∫ø b·∫•t ƒë·ªìng b·ªô c∆° b·∫£n, d·ªÖ g√¢y callback hell |
| Promise       | C·∫£i thi·ªán c·∫•u tr√∫c b·∫•t ƒë·ªìng b·ªô                  |
| Async/Await   | C√∫ ph√°p hi·ªán ƒë·∫°i, d·ªÖ ƒë·ªçc, d·ªÖ debug              |
| Event Loop    | ƒêi·ªÅu ph·ªëi microtask v√† macrotask               |

Khi b·∫°n hi·ªÉu r√µ Promise v√† Event Loop, b·∫°n kh√¥ng ch·ªâ vi·∫øt code JS t·ªët h∆°n ‚Äî
m√† c√≤n hi·ªÉu s√¢u h∆°n c√°ch JavaScript v·∫≠n h√†nh b√™n trong.
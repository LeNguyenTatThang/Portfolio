---
title: "Hiá»ƒu rÃµ Event Loop trong JavaScript â€“ Tá»«ng bÆ°á»›c má»™t"
slug: "hieu-ro-event-loop"
excerpt: "Giáº£i thÃ­ch chi tiáº¿t cÆ¡ cháº¿ Event Loop, Call Stack, Microtask vÃ  Macrotask trong JavaScript."
cover_image: "/images/blog/event-loop-cover.jpg"
date: "2025-01-12"
tags:
  - javascript
  - eventloop
  - async
  - promise
---

# Hiá»ƒu rÃµ Event Loop trong JavaScript â€“ Tá»«ng bÆ°á»›c má»™t

JavaScript lÃ  **ngÃ´n ngá»¯ Ä‘Æ¡n luá»“ng (single-threaded)** â€” nhÆ°ng láº¡i cÃ³ kháº£ nÄƒng xá»­ lÃ½ **báº¥t Ä‘á»“ng bá»™ (asynchronous)** má»™t cÃ¡ch cá»±c ká»³ hiá»‡u quáº£.  
Äiá»u nÃ y Ä‘áº¡t Ä‘Æ°á»£c nhá» **Event Loop**, thá»© giÃºp JavaScript â€œÄ‘a nhiá»‡mâ€ mÃ  khÃ´ng thá»±c sá»± cháº¡y song song.

---

## ğŸ§  Call Stack lÃ  gÃ¬?

Má»i hÃ m khi Ä‘Æ°á»£c gá»i trong JavaScript Ä‘á»u Ä‘Æ°á»£c Ä‘áº©y vÃ o **Call Stack**.

```js
function foo() {
  console.log("Foo");
}

function bar() {
  foo();
  console.log("Bar");
}

bar();
// Output:
// Foo
// Bar
Call Stack hoáº¡t Ä‘á»™ng theo nguyÃªn táº¯c LIFO (Last In, First Out).
HÃ m nÃ o Ä‘Æ°á»£c gá»i sau thÃ¬ sáº½ Ä‘Æ°á»£c thá»±c thi trÆ°á»›c khi quay láº¡i hÃ m trÆ°á»›c Ä‘Ã³.

â³ Váº¥n Ä‘á»: Blocking Code
Náº¿u má»™t Ä‘oáº¡n code cháº¡y quÃ¡ lÃ¢u (vÃ­ dá»¥ xá»­ lÃ½ dá»¯ liá»‡u lá»›n hoáº·c chá» API), toÃ n bá»™ chÆ°Æ¡ng trÃ¬nh sáº½ bá»‹ cháº·n (blocked):

```js
function heavyTask() {
  for (let i = 0; i < 1e9; i++) {}
  console.log("Done!");
}

console.log("Start");
heavyTask();
console.log("End");
// Output:
// Start
// Done!
// End
```

Má»i thá»© sau heavyTask() Ä‘á»u pháº£i Ä‘á»£i nÃ³ hoÃ n thÃ nh.
=> ÄÃ¢y lÃ  lÃ½ do JavaScript cáº§n cÆ¡ cháº¿ báº¥t Ä‘á»“ng bá»™.

ğŸŒ€ Event Loop hoáº¡t Ä‘á»™ng tháº¿ nÃ o?
Khi ta sá»­ dá»¥ng cÃ¡c hÃ m nhÆ° setTimeout, fetch, hay Promise, chÃºng Ä‘Æ°á»£c Ä‘Æ°a sang Web API (trÃ¬nh duyá»‡t cung cáº¥p) thay vÃ¬ cháº¡y trá»±c tiáº¿p trong Stack.

Sau khi hoÃ n thÃ nh, callback cá»§a chÃºng sáº½ Ä‘Æ°á»£c Ä‘áº©y vÃ o hÃ ng Ä‘á»£i (Queue) Ä‘á»ƒ Event Loop xá»­ lÃ½.

```js
console.log("Start");

setTimeout(() => console.log("Timeout!"), 0);

console.log("End");

// Output:
// Start
// End
// Timeout!
```

DÃ¹ setTimeout Ä‘áº·t 0ms, nÃ³ váº«n cháº¡y sau cÃ¹ng vÃ¬ pháº£i Ä‘á»£i Event Loop Ä‘Æ°a callback vÃ o láº¡i Stack.

âš™ï¸ Microtask vs Macrotask
Macrotask Queue: chá»©a cÃ¡c tÃ¡c vá»¥ nhÆ° setTimeout, setInterval.

Microtask Queue: chá»©a Promise.then, queueMicrotask, v.v.

Event Loop sáº½ Æ°u tiÃªn microtask trÆ°á»›c macrotask má»—i vÃ²ng láº·p.

```js

console.log("Start");

setTimeout(() => console.log("Macrotask"), 0);

Promise.resolve().then(() => console.log("Microtask"));

console.log("End");

// Output:
// Start
// End
// Microtask
// Macrotask
```
ğŸ” Tá»•ng káº¿t
Event Loop chÃ­nh lÃ  "ngÆ°á»i Ä‘iá»u phá»‘i" giÃºp JavaScript:

KhÃ´ng bá»‹ block khi xá»­ lÃ½ tÃ¡c vá»¥ dÃ i

Thá»±c hiá»‡n báº¥t Ä‘á»“ng bá»™ hiá»‡u quáº£

Giá»¯ cho UI luÃ´n mÆ°á»£t mÃ 

## ğŸ’¡ Ghi nhá»› nhanh

| ThÃ nh pháº§n       | MÃ´ táº£                                        |
|-----------------|---------------------------------------------|
| Call Stack       | NÆ¡i thá»±c thi hÃ m tuáº§n tá»±                    |
| Web APIs         | Xá»­ lÃ½ tÃ¡c vá»¥ báº¥t Ä‘á»“ng bá»™                    |
| Callback Queue   | HÃ ng Ä‘á»£i chá» thá»±c thi                        |
| Event Loop       | Äiá»u phá»‘i luá»“ng xá»­ lÃ½ giá»¯a Stack vÃ  Queue   |
| Microtask Queue  | Æ¯u tiÃªn Promise, mutation observer           |
